<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EggScan æ–‡çŒ®æ™ºèƒ½åˆ†æç³»ç»Ÿ v2.0</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23F59E0B' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 22c-5 0-9-4.5-9-10 0-2.5 1-5 2.5-6.5C7 4 8.5 2 12 2c3.5 0 5 2 6.5 3.5C20 7 21 9.5 21 12c0 5.5-4 10-9 10z'/%3E%3Cpath d='m10 14 2-2 2 2'/%3E%3C/svg%3E">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* antd: ã€ä¸­æ–‡æ³¨é‡Šã€‘ä½¿ç”¨æ›´é€‚åˆä¸­æ–‡é˜…è¯»çš„å­—ä½“ */
        body { font-family: 'Noto Sans SC', sans-serif; }
        /* antd: ã€ä¸­æ–‡æ³¨é‡Šã€‘è‡ªå®šä¹‰åŠ è½½åŠ¨ç”» */
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #5B9BD5;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* antd: ã€ä¸­æ–‡æ³¨é‡Šã€‘ä¼˜åŒ–æ–‡ä»¶è¾“å…¥æ¡†æ ·å¼ */
        input[type="file"]::file-selector-button {
            background-color: #5B9BD5;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        input[type="file"]::file-selector-button:hover {
            background-color: #4A88C3;
        }
        /* antd: ã€ä¸­æ–‡æ³¨é‡Šã€‘è¿›åº¦æ¡æ ·å¼ */
        .progress-bar {
            background-color: #e9ecef;
            border-radius: 0.375rem;
            overflow: hidden;
        }
        .progress-bar-inner {
            background-color: #5B9BD5;
            height: 100%;
            transition: width 0.4s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div class="container mx-auto p-4 md:p-8 max-w-5xl">
        <div class="bg-white rounded-2xl shadow-2xl p-8 md:p-12">
            
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-gray-800 flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="inline-block h-10 w-10 mr-3 text-amber-500">
                        <path d="M12 22c-5 0-9-4.5-9-10 0-2.5 1-5 2.5-6.5C7 4 8.5 2 12 2c3.5 0 5 2 6.5 3.5C20 7 21 9.5 21 12c0 5.5-4 10-9 10z"/>
                        <path d="m10 14 2-2 2 2"/>
                    </svg>
                    EggScan
                </h1>
                <p class="text-lg text-gray-500 mt-2">æ–‡çŒ®æ™ºèƒ½åˆ†æç³»ç»Ÿ v2.0 Â· äº‘ç«¯ç‰ˆ</p>
            </div>

            <form id="upload-form" class="space-y-8">
                
                <div>
                    <label class="text-lg font-semibold text-gray-700 block mb-3">æ­¥éª¤ 1: ä¸Šä¼ PDFæ–‡çŒ®</label>
                    <input type="file" id="pdfs" name="pdfs" multiple required
                           class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 cursor-pointer">
                    <p class="text-xs text-gray-400 mt-2">å¯ä»¥ä¸€æ¬¡é€‰æ‹©å¤šä¸ªæ–‡ä»¶ã€‚æœ€å¤§æ€»ä¸Šä¼ å¤§å°: 100MBã€‚</p>
                </div>

                <div>
                    <label for="apiKey" class="text-lg font-semibold text-gray-700 block mb-3">æ­¥éª¤ 2: è¾“å…¥APIå¯†é’¥</label>
                    <input type="password" id="apiKey" name="apiKey" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                           placeholder="è¯·è¾“å…¥æ‚¨çš„ DeepSeek API Key (sk-...)">
                    <div class="flex items-center mt-2">
                        <input type="checkbox" id="saveKey" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                        <label for="saveKey" class="ml-2 text-sm text-gray-600">åœ¨æµè§ˆå™¨ä¸­ä¿å­˜å¯†é’¥</label>
                    </div>
                </div>

                <div>
                    <label class="text-lg font-semibold text-gray-700 block mb-3">æ­¥éª¤ 3: é€‰æ‹©åˆ†ææ¨¡å¼</label>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <label class="p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition has-[:checked]:bg-blue-50 has-[:checked]:border-blue-400 has-[:checked]:ring-2 has-[:checked]:ring-blue-300">
                            <input type="radio" name="mode" value="ç»å…¸æ¨¡å¼" class="sr-only" checked>
                            <span class="font-bold text-gray-800">ğŸ“œ ç»å…¸äº”æ®µå¼</span>
                            <p class="text-sm text-gray-500 mt-1">å¿«é€Ÿæ„å»ºæ–‡ç« æ¡†æ¶ï¼Œæå–èƒŒæ™¯ã€æ–¹æ³•ã€ç»“æœç­‰ã€‚</p>
                        </label>
                        <label class="p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition has-[:checked]:bg-blue-50 has-[:checked]:border-blue-400 has-[:checked]:ring-2 has-[:checked]:ring-blue-300">
                            <input type="radio" name="mode" value="ç²¾è¯»æ¨¡å¼" class="sr-only">
                            <span class="font-bold text-gray-800">ğŸ“š ç²¾è¯»æ¨¡å¼</span>
                            <p class="text-sm text-gray-500 mt-1">æ·±åº¦æ‰¹åˆ¤æ€§åˆ†æï¼Œè·å–ç ”ç©¶å¯å‘ã€‚</p>
                        </label>
                        <label class="p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition has-[:checked]:bg-blue-50 has-[:checked]:border-blue-400 has-[:checked]:ring-2 has-[:checked]:ring-blue-300">
                            <input type="radio" name="mode" value="è‡ªå®šä¹‰æ¨¡å¼" class="sr-only">
                            <span class="font-bold text-gray-800">ğŸ¯ è‡ªå®šä¹‰æ¨¡å¼</span>
                            <p class="text-sm text-gray-500 mt-1">æŒ‰éœ€å®šåˆ¶åˆ†æç»´åº¦ã€‚</p>
                        </label>
                    </div>
                </div>

                <div id="custom-prompt-container" class="hidden">
                    <label for="customPrompt" class="text-lg font-semibold text-gray-700 block mb-3">è‡ªå®šä¹‰åˆ†æè¦æ±‚</label>
                    <textarea id="customPrompt" name="customPrompt" rows="8"
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                              placeholder="è¯·è¾“å…¥æ‚¨çš„åˆ†æè¦æ±‚ï¼Œä¾‹å¦‚ï¼š&#10;ã€ç ”ç©¶ä¸»é¢˜ã€‘ï¼š...&#10;ã€æ–¹æ³•åˆ›æ–°ã€‘ï¼š...&#10;è¯·ä½¿ç”¨ã€å­—æ®µåã€‘ï¼šå†…å®¹ çš„æ ¼å¼ã€‚"></textarea>
                </div>

                <div class="flex flex-col md:flex-row items-center gap-6">
                    <div>
                        <label for="language" class="text-lg font-semibold text-gray-700 block mb-2">æ­¥éª¤ 4: è¾“å‡ºè¯­è¨€</label>
                        <select id="language" name="language" class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="ä¸­æ–‡">ä¸­æ–‡</option>
                            <option value="English">English</option>
                        </select>
                    </div>
                    <button type="submit" id="submit-btn"
                            class="w-full md:w-auto bg-blue-600 text-white font-bold py-4 px-8 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all duration-300 ease-in-out transform hover:scale-105">
                        å¼€å§‹åˆ†æ
                    </button>
                </div>
            </form>
            
            <div class="mt-8 p-5 bg-amber-50 rounded-lg border-l-4 border-amber-400">
                <h3 class="text-lg font-bold text-amber-700 mb-3 flex items-center">
                    ğŸ’¡ ä½¿ç”¨æç¤º
                </h3>
                <ul class="list-none p-0 space-y-2 text-gray-600 text-sm">
                    <li class="flex items-start"><span class="text-amber-500 font-bold mr-2">âœ“</span> <span>æ³›è¯»æ¨¡å¼é€‚åˆå¿«é€Ÿç­›é€‰å¤§é‡æ–‡çŒ®</span></li>
                    <li class="flex items-start"><span class="text-amber-500 font-bold mr-2">âœ“</span> <span>ç²¾è¯»æ¨¡å¼é€‚åˆæ·±åº¦åˆ†æé‡è¦æ–‡çŒ®</span></li>
                    <li class="flex items-start"><span class="text-amber-500 font-bold mr-2">âœ“</span> <span>å¤„ç†æ—¶é—´å–å†³äºæ–‡çŒ®æ•°é‡å’Œé•¿åº¦</span></li>
                    <li class="flex items-start"><span class="text-amber-500 font-bold mr-2">âœ“</span> <span>å»ºè®®æ¯æ¬¡å¤„ç†ä¸è¶…è¿‡10ç¯‡æ–‡çŒ®</span></li>
                </ul>
            </div>
            
            <div id="loader" class="hidden text-center mt-8 space-y-4">
                <div class="loader mx-auto"></div>
                <p id="status-text" class="text-gray-600 font-medium">æ­£åœ¨åˆå§‹åŒ–...</p>
                <div class="progress-bar w-full h-2.5">
                    <div id="progress-bar-inner" class="progress-bar-inner w-0"></div>
                </div>
                <div id="progress-messages" class="mt-4 max-h-48 overflow-y-auto bg-gray-50 p-3 rounded-md border text-sm text-left text-gray-700 leading-relaxed shadow-inner">
                    </div>
                <p class="text-sm text-gray-400">(å¤§å‹æˆ–æ‰«æç‰ˆPDFå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´)</p>
            </div>
            
            <div id="error-message" class="hidden mt-6 bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-lg" role="alert">
                <p class="font-bold">åˆ†æå‡ºé”™</p>
                <p id="error-text"></p>
            </div>
        </div>
    </div>

    <script>
        // antd: ã€ä¸­æ–‡æ³¨é‡Šã€‘æ ¸å¿ƒäº¤äº’é€»è¾‘
        const form = document.getElementById('upload-form');
        const submitBtn = document.getElementById('submit-btn');
        const loader = document.getElementById('loader');
        const statusText = document.getElementById('status-text');
        const errorMessage = document.getElementById('error-message');
        const errorText = document.getElementById('error-text');
        const apiKeyInput = document.getElementById('apiKey');
        const saveKeyCheckbox = document.getElementById('saveKey');
        const customPromptContainer = document.getElementById('custom-prompt-container');
        const customPromptTextarea = document.getElementById('customPrompt');
        const modeRadios = document.querySelectorAll('input[name="mode"]');
        
        // antd: ã€ä¸­æ–‡æ³¨é‡Šã€‘è·å–æ–°å¢çš„è¿›åº¦æ¡å’Œæ¶ˆæ¯æ—¥å¿—å…ƒç´ 
        const progressBarInner = document.getElementById('progress-bar-inner');
        const progressMessages = document.getElementById('progress-messages');

        // antd: ã€ä¸­æ–‡æ³¨é‡Šã€‘ä»LocalStorageåŠ è½½å·²ä¿å­˜çš„API Key
        const savedApiKey = localStorage.getItem('eggscan_api_key');
        if (savedApiKey) {
            apiKeyInput.value = savedApiKey;
            saveKeyCheckbox.checked = true;
        }

        // antd: ã€ä¸­æ–‡æ³¨é‡Šã€‘ä¿å­˜æˆ–æ¸…é™¤API Key
        saveKeyCheckbox.addEventListener('change', () => {
            if (saveKeyCheckbox.checked) {
                localStorage.setItem('eggscan_api_key', apiKeyInput.value);
            } else {
                localStorage.removeItem('eggscan_api_key');
            }
        });
        apiKeyInput.addEventListener('input', () => {
            if (saveKeyCheckbox.checked) {
                localStorage.setItem('eggscan_api_key', apiKeyInput.value);
            }
        });

        // antd: ã€ä¸­æ–‡æ³¨é‡Šã€‘ç›‘å¬æ¨¡å¼é€‰æ‹©ï¼Œæ§åˆ¶è‡ªå®šä¹‰è¾“å…¥æ¡†çš„æ˜¾ç¤º
        const defaultCustomPrompt = `è¯·ä»ä»¥ä¸‹è§’åº¦åˆ†æè¿™ç¯‡æ–‡çŒ®ï¼š\n\nã€ç ”ç©¶ä¸»é¢˜ã€‘ï¼šæ–‡ç« çš„æ ¸å¿ƒç ”ç©¶é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ\nã€ç†è®ºæ¡†æ¶ã€‘ï¼šä½¿ç”¨äº†ä»€ä¹ˆç†è®ºåŸºç¡€æˆ–æ¦‚å¿µæ¡†æ¶ï¼Ÿ\nã€æ–¹æ³•åˆ›æ–°ã€‘ï¼šåœ¨ç ”ç©¶æ–¹æ³•ä¸Šæœ‰ä»€ä¹ˆåˆ›æ–°æˆ–ç‰¹è‰²ï¼Ÿ\nã€æ•°æ®è´¨é‡ã€‘ï¼šæ•°æ®æ¥æºã€æ ·æœ¬é‡ã€ç»Ÿè®¡åˆ†æçš„å¯é æ€§å¦‚ä½•ï¼Ÿ\nã€å…³é”®å‘ç°ã€‘ï¼šæœ€é‡è¦çš„3ä¸ªç ”ç©¶å‘ç°æ˜¯ä»€ä¹ˆï¼Ÿ\nã€å®è·µæ„ä¹‰ã€‘ï¼šå¯¹ä¸´åºŠå®è·µæˆ–æ”¿ç­–åˆ¶å®šæœ‰ä»€ä¹ˆæŒ‡å¯¼æ„ä¹‰ï¼Ÿ\nã€äº‰è®®ä¸è®¨è®ºã€‘ï¼šå­˜åœ¨å“ªäº›äº‰è®®ç‚¹æˆ–å€¼å¾—è¿›ä¸€æ­¥è®¨è®ºçš„é—®é¢˜ï¼Ÿ\nã€å¼•ç”¨ä»·å€¼ã€‘ï¼šè¿™ç¯‡æ–‡ç« æœ€å€¼å¾—å¼•ç”¨çš„è§‚ç‚¹æˆ–æ•°æ®æ˜¯ä»€ä¹ˆï¼Ÿ\n\nè¯·ç”¨ã€å­—æ®µåã€‘ï¼šå†…å®¹ çš„æ ¼å¼æ¸…æ™°è¾“å‡ºã€‚`;
        
        modeRadios.forEach(radio => {
            radio.addEventListener('change', () => {
                if (radio.value === 'è‡ªå®šä¹‰æ¨¡å¼') {
                    customPromptContainer.classList.remove('hidden');
                    if (customPromptTextarea.value.trim() === '') {
                        customPromptTextarea.value = defaultCustomPrompt;
                    }
                } else {
                    customPromptContainer.classList.add('hidden');
                }
            });
        });
        
        // antd: ã€ä¸­æ–‡æ³¨é‡Šã€‘å¤„ç†è¡¨å•æäº¤
        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData(form);
            const files = document.getElementById('pdfs').files;
            
            if (files.length === 0) {
                showError('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªPDFæ–‡ä»¶ã€‚');
                return;
            }
            if (!apiKeyInput.value.startsWith('sk-')) {
                showError('è¯·è¾“å…¥ä¸€ä¸ªæœ‰æ•ˆçš„DeepSeek APIå¯†é’¥ã€‚');
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = 'åˆ†æä¸­...';
            loader.classList.remove('hidden');
            errorMessage.classList.add('hidden');
            progressMessages.innerHTML = ''; // antd: ã€ä¸­æ–‡æ³¨é‡Šã€‘æ¯æ¬¡å¼€å§‹å‰æ¸…ç©ºæ—§æ—¥å¿—

            updateProgress(0, 'æ­£åœ¨åˆå§‹åŒ–...');
            addProgressMessage('ä»»åŠ¡å·²æäº¤ï¼Œæ­£åœ¨åˆå§‹åŒ–...'); // antd: ã€ä¸­æ–‡æ³¨é‡Šã€‘æ·»åŠ ç¬¬ä¸€æ¡æ—¥å¿—

            try {
                // antd: ã€ä¸­æ–‡æ³¨é‡Šã€‘è°ƒç”¨å¢å¼ºç‰ˆçš„è¿›åº¦æ¨¡æ‹Ÿå‡½æ•°
                await simulateProgress(files.length); 
                
                const response = await fetch('/analyze', {
                    method: 'POST',
                    body: formData,
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'æœåŠ¡å™¨è¿”å›äº†ä¸€ä¸ªæœªçŸ¥é”™è¯¯ã€‚');
                }
                
                updateProgress(100, 'åˆ†æå®Œæˆï¼æ­£åœ¨å‡†å¤‡ä¸‹è½½...');
                addProgressMessage('âœ… åˆ†ææˆåŠŸ! æŠ¥å‘Šå·²ç”Ÿæˆï¼Œå³å°†å¼€å§‹ä¸‹è½½ã€‚'); // antd: ã€ä¸­æ–‡æ³¨é‡Šã€‘æ·»åŠ æˆåŠŸæ—¥å¿—
                
                const blob = await response.blob();
                const header = response.headers.get('Content-Disposition');
                const parts = header.split(';');
                let filename = 'EggScan_Report.xlsx';
                for (const part of parts) {
                    if (part.trim().startsWith('filename=')) {
                        filename = part.substring(part.indexOf('=') + 1).trim();
                        filename = decodeURIComponent(filename.replace(/['"]/g, ''));
                        break;
                    }
                }
                
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);

            } catch (error) {
                let friendlyErrorMessage = 'åˆ†æå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚';
                if (error instanceof TypeError && (error.message.includes('Failed to fetch') || error.message.includes('NetworkError'))) {
                    friendlyErrorMessage = 'ç½‘ç»œè¿æ¥é”™è¯¯ã€‚\nè¿™å¾ˆå¯èƒ½æ˜¯å› ä¸ºåˆ†ææ—¶é—´è¿‡é•¿å¯¼è‡´è¿æ¥è¶…æ—¶ã€‚\n\næ‚¨å¯ä»¥å°è¯•ä»¥ä¸‹æ“ä½œï¼š\n1. æ£€æŸ¥æ‚¨çš„ç½‘ç»œè¿æ¥ã€‚\n2. å°è¯•ä¸€æ¬¡åªåˆ†æä¸€ä¸ªæ–‡ä»¶ï¼Œç‰¹åˆ«æ˜¯å¯¹äºæ‰«æç‰ˆæˆ–éå¸¸å¤§çš„PDFã€‚\n3. å¦‚æœåœ¨æœåŠ¡å™¨éƒ¨ç½²ï¼Œè¯·æ£€æŸ¥WebæœåŠ¡å™¨ï¼ˆå¦‚Gunicornï¼‰çš„è¶…æ—¶è®¾ç½®ã€‚';
                } else {
                    friendlyErrorMessage = error.message;
                }
                showError(friendlyErrorMessage);
                updateProgress(0, 'å‡ºç°é”™è¯¯');
                addProgressMessage(`âŒ åˆ†æå¤±è´¥: ${error.message}`); // antd: ã€ä¸­æ–‡æ³¨é‡Šã€‘æ·»åŠ é”™è¯¯æ—¥å¿—
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'å¼€å§‹åˆ†æ';
                setTimeout(() => {
                    loader.classList.add('hidden');
                }, 2000); // antd: ã€ä¸­æ–‡æ³¨é‡Šã€‘ç¨ä½œåœç•™ï¼Œè®©ç”¨æˆ·çœ‹åˆ°æœ€ç»ˆçŠ¶æ€
            }
        });

        // antd: ã€ä¸­æ–‡æ³¨é‡Šã€‘ç”¨äºå‘æ—¥å¿—çª—å£æ·»åŠ æ¶ˆæ¯çš„å‡½æ•°
        function addProgressMessage(message) {
            const msgDiv = document.createElement('div');
            // antd: ã€ä¸­æ–‡æ³¨é‡Šã€‘ä½¿ç”¨Tailwind CSSè®¾è®¡æ—¥å¿—æ¡ç›®æ ·å¼
            msgDiv.className = 'mb-1 py-1 px-2 border-l-4 border-gray-300';
            
            if (message.includes('æˆåŠŸ') || message.includes('âœ…')) {
                msgDiv.className = 'mb-1 py-1 px-2 border-l-4 border-green-500 bg-green-50';
            } else if (message.includes('å¤±è´¥') || message.includes('âŒ')) {
                msgDiv.className = 'mb-1 py-1 px-2 border-l-4 border-red-500 bg-red-50';
            }

            msgDiv.textContent = message;
            progressMessages.appendChild(msgDiv);
            // antd: ã€ä¸­æ–‡æ³¨é‡Šã€‘è‡ªåŠ¨æ»šåŠ¨åˆ°æœ€æ–°æ¶ˆæ¯
            progressMessages.scrollTop = progressMessages.scrollHeight;
        }

        // antd: ã€ä¸­æ–‡æ³¨é‡Šã€‘æ›´æ–°ä¸»çŠ¶æ€æ–‡æœ¬å’Œè¿›åº¦æ¡
        function updateProgress(percentage, text) {
            progressBarInner.style.width = `${percentage}%`;
            statusText.textContent = text;
        }

        // antd: ã€ä¸­æ–‡æ³¨é‡Šã€‘æ¨¡æ‹Ÿè¿›åº¦çš„å‡½æ•°ï¼Œç°åœ¨ä¼šåŒæ­¥æ›´æ–°æ—¥å¿—
        function simulateProgress(fileCount) {
            return new Promise(resolve => {
                let currentProgress = 0;
                const uploadTime = 1000;
                const analysisTimePerFile = 2000;
                
                // é˜¶æ®µ1: ä¸Šä¼ 
                setTimeout(() => {
                    currentProgress = 15;
                    updateProgress(currentProgress, `æ­£åœ¨ä¸Šä¼  ${fileCount} ä¸ªæ–‡ä»¶...`);
                    addProgressMessage(`[1/3] æ–‡ä»¶ä¸Šä¼ ä¸­...`);
                    
                    // é˜¶æ®µ2: åˆ†æ
                    let analyzedFiles = 0;
                    addProgressMessage(`[2/3] å¼€å§‹é€ç¯‡åˆ†ææ–‡çŒ®...`);
                    const analysisInterval = setInterval(() => {
                        if (analyzedFiles >= fileCount) {
                            clearInterval(analysisInterval);
                            // é˜¶æ®µ3: ç”ŸæˆæŠ¥å‘Š
                            currentProgress = 95;
                            updateProgress(currentProgress, 'æ­£åœ¨ç”ŸæˆExcelæŠ¥å‘Š...');
                            addProgressMessage('[3/3] æ‰€æœ‰æ–‡ä»¶åˆ†æå®Œæ¯•ï¼Œæ­£åœ¨ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š...');
                            resolve(); // antd: ã€ä¸­æ–‡æ³¨é‡Šã€‘æ¨¡æ‹Ÿå®Œæˆï¼Œè¿”å›ä¸»æµç¨‹
                            return;
                        }
                        
                        analyzedFiles++;
                        const progressPerFile = 80 / fileCount;
                        currentProgress += progressPerFile;
                        updateProgress(Math.min(95, currentProgress), `æ­£åœ¨åˆ†æç¬¬ ${analyzedFiles} / ${fileCount} ç¯‡æ–‡çŒ®...`);
                        addProgressMessage(`  - æ­£åœ¨å¤„ç†æ–‡çŒ® #${analyzedFiles}`);
                    }, analysisTimePerFile);
                }, uploadTime);
            });
        }

        function showError(message) {
            errorText.innerHTML = message.replace(/\n/g, '<br>');
            errorMessage.classList.remove('hidden');
        }
    </script>
</body>
</html>
